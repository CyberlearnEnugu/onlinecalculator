<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Calculator</title>
  <style>
    :root{
      --bg: #0f1724;
      --panel: #0b1220;
      --accent: #2563eb;
      --accent-2: #ef4444;
      --muted: #94a3b8;
      --glass: rgba(255,255,255,0.04);
      --btn-shadow: 0 6px 18px rgba(2,6,23,0.6);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg, #071027 0%, #081229 100%);
      color:#e6eef8;
      padding:24px;
    }

    .calculator{
      width: min(420px, 95vw);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:18px;
      padding:20px;
      box-shadow: var(--btn-shadow);
      border: 1px solid rgba(255,255,255,0.04);
      backdrop-filter: blur(6px);
    }

    .display{
      height:84px;
      border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.15));
      padding:12px 16px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      margin-bottom:16px;
      box-shadow: inset 0 -6px 20px rgba(2,6,23,0.35);
      position:relative;
      overflow:hidden;
    }
    .expr{
      font-size:14px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin-bottom:6px;
      padding-right:6px;
    }
    .result{
      font-size:28px;
      font-weight:600;
      text-align:right;
      line-height:1;
      letter-spacing:0.5px;
      padding-right:6px;
      word-break:break-all;
    }

    .keys{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }

    button.key{
      border: none;
      background:var(--glass);
      height:56px;
      border-radius:10px;
      font-size:18px;
      color: #e6eef8;
      cursor:pointer;
      box-shadow: 0 6px 14px rgba(2,6,23,0.45);
      transition: transform .06s ease, box-shadow .12s ease, background .12s;
      user-select:none;
    }
    button.key:active{ transform: translateY(2px) }
    button.key.operator{ background: linear-gradient(180deg, rgba(37,99,235,0.15), rgba(37,99,235,0.06)); }
    button.key.equal{ background: linear-gradient(90deg, #2563eb, #7c3aed); font-weight:700; font-size:18px; color:white; grid-column: span 2; }
    button.key.clear{ background: linear-gradient(180deg, rgba(239,68,68,0.12), rgba(239,68,68,0.06)); }
    button.key.wide{ grid-column: span 2; }

    .footer{
      margin-top:12px;
      font-size:12px;
      color:var(--muted);
      text-align:center;
    }

    /* small screens */
    @media (max-width:380px){
      .result{ font-size:22px }
      .display{ height:74px }
      button.key{ height:52px; font-size:16px }
    }
  </style>
</head>
<body>
  <main class="calculator" role="application" aria-label="Simple calculator">
    <div class="display" aria-live="polite">
      <div id="expression" class="expr" aria-hidden="true"> </div>
      <div id="result" class="result" aria-atomic="true">0</div>
    </div>

    <div class="keys" role="group" aria-label="Calculator buttons">
      <button class="key clear" data-action="clear" aria-label="Clear (Escape)">AC</button>
      <button class="key" data-action="back" aria-label="Backspace (Backspace)">⌫</button>
      <button class="key operator" data-value="%" aria-label="Percent">%</button>
      <button class="key operator" data-value="/" aria-label="Divide">÷</button>

      <button class="key" data-value="7">7</button>
      <button class="key" data-value="8">8</button>
      <button class="key" data-value="9">9</button>
      <button class="key operator" data-value="*" aria-label="Multiply">×</button>

      <button class="key" data-value="4">4</button>
      <button class="key" data-value="5">5</button>
      <button class="key" data-value="6">6</button>
      <button class="key operator" data-value="-" aria-label="Minus">−</button>

      <button class="key" data-value="1">1</button>
      <button class="key" data-value="2">2</button>
      <button class="key" data-value="3">3</button>
      <button class="key operator" data-value="+" aria-label="Plus">+</button>

      <button class="key wide" data-value="0" aria-label="Zero">0</button>
      <button class="key" data-value="." aria-label="Decimal point">.</button>
      <button class="key equal" data-action="equals" aria-label="Equals (Enter)">=</button>
    </div>

    <div class="footer">Tip: use keyboard (numbers, + - * /, Enter, Backspace, Escape)</div>
  </main>

  <script>
    (function(){
      const exprEl = document.getElementById('expression');
      const resultEl = document.getElementById('result');
      const keys = document.querySelectorAll('button.key');

      let expression = ''; // user-facing expression (as text)
      let computed = false; // flag if last action was compute

      // sanitize: allow digits, operators, parentheses, dot, percent and spaces
      function isValidForEval(s){
        return /^[0-9+\-*/().%\s]*$/.test(s);
      }

      // convert expression to JS-eval-friendly expression:
      // - replace Unicode × ÷ − with * / -
      // - convert % to /100 (as shorthand, but handle sequences like 50% -> (50/100))
      function toEvalString(s){
        if(!s) return '0';
        // normalize some symbols:
        s = s.replace(/×/g, '*').replace(/÷/g, '/').replace(/−/g,'-');
        // Replace percent occurrences: number% -> (number/100)
        // We'll replace e.g. "50%" -> "(50/100)"
        s = s.replace(/(\d+(?:\.\d*)?)%/g, '($1/100)');
        return s;
      }

      function updateDisplay(){
        exprEl.textContent = expression || '';
      }

      function setResultText(value){
        resultEl.textContent = String(value);
      }

      function clearAll(){
        expression = '';
        computed = false;
        updateDisplay();
        setResultText(0);
      }

      function backspace(){
        if(computed){
          // if last was computed, backspace should clear result and start fresh
          expression = '';
          computed = false;
          updateDisplay();
          setResultText(0);
          return;
        }
        expression = expression.slice(0, -1);
        updateDisplay();
      }

      function append(value){
        if(computed){
          // if result was just computed and user types a digit or dot -> start new expression
          if(/[0-9.]/.test(value)){
            expression = value;
            computed = false;
            updateDisplay();
            return;
          } else {
            // if operator typed, continue with previous result
            computed = false;
            // fall through to append
          }
        }
        expression += value;
        updateDisplay();
      }

      function safeEvaluate(expr){
        try{
          const evalStr = toEvalString(expr);
          if(!isValidForEval(evalStr)) throw new Error('Invalid characters');
          // Evaluate with Function (safer than eval in this context)
          // `Function` still executes code but we validated allowed characters.
          const result = Function('"use strict"; return (' + evalStr + ')')();
          if(typeof result === 'number' && isFinite(result)){
            // limit decimal places sensibly:
            return Math.round((result + Number.EPSILON) * 1e12) / 1e12;
          } else {
            throw new Error('Invalid result');
          }
        } catch (e){
          return 'Error';
        }
      }

      // attach click handlers
      keys.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const v = btn.getAttribute('data-value');
          const action = btn.getAttribute('data-action');

          if(action === 'clear'){
            clearAll();
            return;
          }
          if(action === 'back'){
            backspace();
            return;
          }
          if(action === 'equals'){
            const res = safeEvaluate(expression);
            setResultText(res);
            computed = true;
            return;
          }
          if(v !== null){
            append(v);
          }
        });
      });

      // keyboard support
      window.addEventListener('keydown', (ev) => {
        const k = ev.key;
        if((/^[0-9]$/.test(k)) || k === '.' ){
          append(k);
          ev.preventDefault();
          return;
        }
        if(k === '+' || k === '-' || k === '*' || k === '/'){
          append(k);
          ev.preventDefault();
          return;
        }
        if(k === 'Enter' || k === '='){
          const res = safeEvaluate(expression);
          setResultText(res);
          computed = true;
          ev.preventDefault();
          return;
        }
        if(k === 'Backspace'){
          backspace();
          ev.preventDefault();
          return;
        }
        if(k === 'Escape'){
          clearAll();
          ev.preventDefault();
          return;
        }
        if(k === '%'){
          append('%');
          ev.preventDefault();
          return;
        }
        // allow parentheses
        if(k === '(' || k === ')'){
          append(k);
          ev.preventDefault();
          return;
        }
      });

      // initialize
      clearAll();
    })();
  </script>
</body>
</html>
